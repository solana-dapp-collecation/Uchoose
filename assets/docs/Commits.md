# Соглашение о commit'ах

## Сообщения commit'ов

Сообщения commit'ов, в общем случае, должны иметь следующую структуру:

```git
<type>[optional scope]: <description>

[optional body]

[optional footer]
```

Такая структуризация commit'ов может быть использована для:

* Частичной автоматическая генерации списка изменений (CHANGELOG.md и т.п.);
* Автоматического определения семантической версии [SemVer](https://semver.org/lang/ru/) (на основе типов совершенных commit’ов);
* Игнорирования неподходящих commit'ов при поиске места проблемы в кодовой базе (например, с помощью `git bisect`). Если сломался модуль *audio-controls*, то можно смотреть только те сообщения, где в `scope` указан данный модуль;
* Отображения в структурированном и понятном виде истории развития проекта.

### Базовые правила для сообщений

1. Все сообщения commit'ов начинаются с маленькой буквы;
2. Описание `description` и тело `body` начинаются с большой буквы;
3. Все сообщения commit'ов пишутся на русском языке, кроме специальных терминов, обозначений, названий и т.п.;
4. В описании `description` к commit'у (как и в теле commit'а) лучше использовать прошедшее время. Пример:

```git
feat(parser): Добавлена возможность анализа массивов
```

чтобы потом можно было сказать, что в *commit'е #6fgdd123 добавлена возможность анализа массивов*.

5. Следует убирать *лишние* знаки препинания в commit'ах. Например, `.` или `;` в конце сообщения commit'а;
6. Перед отправкой commit'а из локального репозитория в удалённый (общий) репозиторий лучше "подготовить" commit'ы: для этого можно использовать команду `git rebase -i HEAD~5` (где 5 - число затрагиваемых commit'ов), чтобы с помощью неё расставить commit'ы в правильном порядке, объединить их, переименовать в соответствии с установленными правилами:
  - Для удобства можно использовать специальные GUI для работы с git. Например, [TortoiseGIT](https://tortoisegit.org/) или [SourceTree](https://www.sourcetreeapp.com/).
  - Если код уже отправлен в удаленный репозиторий, то rebase лучше не использовать.
7. Каждая строка в сообщении commit'а не должна превышать 80 символов в длину (для тела сообщения - 72);
8. Каждый commit должен иметь свою область ответственности. То есть желательно не вносить несколько изменений в одном commit'е, если их можно разбить на несколько атомарных;
9. Commit необходимо делать при каждом атомарном изменении;
10. Для внесения изменений в комментарий к последнему commit'у в локальном репозитории необходимо использовать команду:

```git
git commit -m "correct message" --amend
```

Если commit уже был отправлен в удаленный репозиторий, то эту команду лучше не использовать.

### Типы commit'ов (`type`)

Commit может иметь следующие типы:

* **fix**: commit с типом `fix` закрывает баг (ошибку) в кодовой базе проекта (соответствует `PATCH` в семантическом версионировании);
* **feat**: commit с типом `feat` вводит новую функциональность уровня приложения (API) в кодовую базу проекта (соответствует `MINOR` в семантическом версионировании);
* **BREAKING CHANGE**: commit с типом `BREAKING CHANGE` (либо с добавлением символа `!` после `type` или `scope`) вводит изменения, нарушающие обратную совместимость API проекта (соответствует `MAJOR` в семантическом версионировании). `BREAKING CHANGE` может быть частью commit'а любого типа;
* также допустимы дополнительные типы commit'ов:
  * **build**: commit с типом `build` добавляет изменения, связанные с инкрементом сборки проекта. Например, при обновлении зависимостей (nuget-пакетов), не затрагивающих функциональность;
  * **chore**: commit с типом `chore` добавляет обычное "обслуживание" кода (исправление мелких ошибок, форматирование, удаления старого кода и т.п.);
  * **docs**: commit с типом `docs` добавляет исправления, связанные с документированием (либо обновлением документации) кодовой базы проекта;
  * **style**: commit с типом `style` исправляет опечатки и оформление кодовой базы проекта в соответствии с используемым Code Style Guide;
  * **refactor**: commit с типом `refactor` добавляет рефакторинг кодовой базы проекта;
  * **update**: commit с типом update добавляет изменения в код, которые не меняют логику приложения;
  * **perf**: commit с типом `perf` добавляет изменения кодовой базы проекта, направленные на улучшение производительности;
  * **test**: commit с типом `test` добавляет изменения кодовой базы проекта, связанные с тестированием (например, unit-тесты);
  * **improvement**: commit с типом `improvement` вносит улучшения в текущую реализацию без добавлений новых функциональностей в кодовую базу проекта;
  * **wip**: commit с типом `wip` означает, что изменения, вносимые им, не являются окончательными (work in progress), то есть задача в процессе разработки. По возможности лучше не использовать этот тип, либо "сворачивать" потом такие commit'ы через `git rebase -i`;
  * и другие (по соглашению всех разработчиков, участвующих в разработке проекта).

### Область действия (`scope`) - *опциональный*

Сразу после типа commit'а без пробелов можно указать в скобках область (`scope`), на которую распространяется commit.
Например, это может быть:

* Область видимости модуля/библиотеки (либо пространство имён):

```git
refactor(audio-controls): Добавлено использование общей библиотеки контролов
```

* Область видимости файла:

```git
chore(Workers.cs): Добавлена задача EmailWorker
```

* Затрагиваемая область:

```git
feat(API): Добавлен метод получения общего баланса
```

### Описание изменений (`description`)

Описание изменений в тексте commit'а должно быть очень коротким и тезисно описывать вносимые commit'ом изменения.

### Тело сообщения commit'а (`body`) - *опциональный*

Тело сообщения commit'а нужно в том случае, если описание решенной проблемы достаточно сложно и не может уместиться в строку заголовка (в `description`).

Кроме того в конце тела сообщения commit'а необходимо ссылаться на задачи в таск-трекере (если они заведены для решаемой проблемы), либо [взаимодействовать с полями задач через команды](https://youtrack.uchoose.com/articles/COM-A-6). Команды отделяются пустой строкой от детального описания в теле сообщения commit'а.

В теле сообщения commit'а вместо того, чтобы указывать, какое исправление вносит этот commit, и для каких целей внесено это исправление (что? и почему?), можно ссылаться на номер задачи в трекере задач и добавить краткие комментарий к нему:

```git
fix(common): Исправлена ошибка с поиском задач

Добавлены следующие возможности, которых не было ранее:
- поиск задачи по тэгу
- поиск задачи по имени
- поиск задачи по связанным задачам (их номерам)

#TGI-2 fixed
#TGI-2 tag Tasks
Необходимо протестировать добавленную функциональность TGI-3
```

То есть в данном сообщении commit'а:

* `type` - **fix**
* `scope` - **common**
* `description` - *Исправлена ошибка с поиском задач*
* `body` - всё остальное (в том числе и ссылки на задачи в таск-трекере).

### Подвал сообщения commit'а (`footer`) - *опциональный*

Если в commit'е помимо основных изменений есть критические изменения (`BREAKING CHANGE`), то их необходимо указывать в подвале сообщения с коротким описанием изменений и примером миграции на новую версию.
Например:

```git
feat(common): Добавлена возможность получения списка карт
#TGI-4 fixed
Необходимо произвести миграцию

BREAKING CHANGES: в метод получения карт теперь передаётся список идентификаторов вместо списка номеров

Вызов метода до:

client.GetCards(numbers)

Вызов метода после:

client.GetCards(ids)
```